name: TestExamples

on:
  push:
    branches:
      - main
  workflow_dispatch:

env:
  WORKING_DIR: ./examples/
  DATA_URL: 'https%3A%2F%2Fgithub.com%2FMat-O-Lab%2FCSVToCSVW%2Fraw%2Fmain%2Fexamples%2Fexample-metadata.json'
  METHOD_URL: ''

jobs:
  TestExamples:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: 0        
      - name: run app
        run: |
          docker-compose up -d
          sleep 10
          docker ps -a
      - name: create YARRRML mapping
        working-directory: ${{env.WORKING_DIR}}
        run: |
          RESULT=$(curl -X 'GET' 'http://localhost:5005/api/informationbearingentities?url=${{env.DATA_URL}}' -H 'accept: */*')
          echo $RESULT > bearingentities.json
          RESULT=$(curl -X 'GET' 'http://localhost:5005/api/informationcontententities?url=${{env.METHOD_URL}}' -H 'accept: */*')
          echo $RESULT > contententities.json
      - name: Commit files # commit the output folder
        uses: EndBug/add-and-commit@v9
        with:
          message: 'updated example output'
          add: '*.* --force'
          cwd: './examples/'
